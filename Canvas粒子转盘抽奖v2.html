<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<!-- ç§»åŠ¨è®¾å¤‡æ ¸å¿ƒé€‚é…ï¼šè§†å£è®¾ç½® -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Canvasç²’å­è½¬ç›˜æŠ½å¥–</title>
<style>
  /* åŸºç¡€é‡ç½®ï¼šç»Ÿä¸€ç›’æ¨¡å‹ + è§¦æ‘¸é«˜äº®æ¸…é™¤ */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }

  /* 1. ä¸»é¢˜å˜é‡ï¼šæš—é»‘/æ˜äº®ä¸¤å¥—æ–¹æ¡ˆ */
  :root {
    /* æš—é»‘ä¸»é¢˜ï¼ˆé»˜è®¤ï¼‰ */
    --modal-overlay: rgba(0, 0, 0, 0.85);
    --modal-bg: #1a1a1a;
    --modal-bg-gradient: linear-gradient(135deg, #1a1a1a, #222);
    --gold-primary: #ffd700;
    --gold-secondary: #ffc107;
    --gold-tertiary: #ffb300;
    --gold-dark: #e6b800;
    --gold-shadow: #ffecb3;
    --gold-glow: #fffacd;
    --text-white: #ffffff;
    --text-gray: #f5f5f5;
    --wheel-shadow: rgba(0,0,0,0.3);
    --body-bg: radial-gradient(circle at center, #2a2a2a, #000);
    --btn-text: #333;
    --textarea-bg: #222;
    --textarea-border: #ffc107;
    --transition-base: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  :root[data-theme="light"] {
    --modal-overlay: rgba(255, 255, 255, 0.85);
    --modal-bg: #f8f9fa;
    --modal-bg-gradient: linear-gradient(135deg, #f8f9fa, #e9ecef);
    --gold-primary: #e6c200;
    --gold-secondary: #d4a800;
    --gold-tertiary: #c29400;
    --gold-dark: #b08000;
    --gold-shadow: #ffe880;
    --gold-glow: #fff2cc;
    --text-white: #212529;
    --text-gray: #495057;
    --wheel-shadow: rgba(0,0,0,0.1);
    --body-bg: radial-gradient(circle at center, #f5f5f5, #e9ecef);
    --btn-text: #212529;
    --textarea-bg: #ffffff;
    --textarea-border: #d4a800;
  }

  body {
    background: var(--body-bg);
    background-size: 150% 150%;
    animation: bgFloat 15s ease-in-out infinite alternate;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    color: var(--text-white);
    font-family: "Microsoft Yahei", Arial, sans-serif;
    overflow: hidden;
    padding: 15px;
    transition: var(--transition-base);
  }

  @keyframes bgFloat {
    0% { background-position: 0% 0%; }
    100% { background-position: 100% 100%; }
  }

  .container {
    text-align: center;
    position: relative;
    width: 100%;
    max-width: 600px;
    animation: containerBreathe 8s ease-in-out infinite alternate;
  }

  @keyframes containerBreathe {
    0% { transform: scale(1); }
    100% { transform: scale(1.02); }
  }

  /* 2. ç§»åŠ¨è®¾å¤‡æŒ‰é’®é€‚é…ï¼šå¢å¤§è§¦æ‘¸åŒºåŸŸ */
  .control-btn {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    background: rgba(255,215,0,0.1);
    border: 1px solid var(--gold-secondary);
    color: var(--gold-primary);
    transition: var(--transition-base);
    cursor: pointer;
    font-size: 24px;
    position: absolute;
    top: 0;
    /* ç§»åŠ¨ç«¯é˜²æ­¢æŒ‰é’®è´´è¾¹ */
    z-index: 10;
  }

  #themeToggle {
    left: 0;
  }

  #settingsBtn {
    right: 0;
  }

  /* 3. å“åº”å¼Canvasï¼šé€‚é…ç§»åŠ¨å±å¹• */
  #canvas {
    display: block;
    margin: 0 auto;
    width: 90vw;
    height: 90vw;
    max-width: 600px;
    max-height: 600px;
    border-radius: 50%;
    box-shadow: 0 0 30px rgba(255,215,0,0.2), 0 0 60px var(--wheel-shadow);
    image-rendering: optimizeQuality;
    image-rendering: -webkit-optimize-contrast;
  }

  /* å¼€å§‹æŒ‰é’®ï¼šç§»åŠ¨ç«¯å¢å¤§padding */
  #startBtn {
    margin: 20px auto 0;
    padding: 15px 40px;
    font-size: 18px;
    font-weight: 700;
    border-radius: 50px;
    border: 2px solid var(--gold-primary);
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-tertiary));
    color: var(--btn-text);
    box-shadow: 0 4px 15px rgba(255,150,0,.8), 0 0 20px rgba(255,215,0,0.3);
    transition: var(--transition-base);
    position: relative;
    overflow: hidden;
    display: block;
    width: 80%;
    max-width: 300px;
  }

  #startBtn::after {
    content: "";
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(to right, transparent, rgba(255,255,255,0.2), transparent);
    transform: rotate(45deg);
    animation: btnShine 3s ease-in-out infinite;
  }

  @keyframes btnShine {
    0% { transform: rotate(45deg) translateX(-100%); }
    100% { transform: rotate(45deg) translateX(100%); }
  }

  textarea {
    width: 100%;
    max-width: 320px;
    height: 180px;
    margin-top: 10px;
    background: var(--textarea-bg);
    color: var(--text-white);
    border: 1px solid var(--textarea-border);
    border-radius: 8px;
    padding: 12px;
    font-size: 14px;
    resize: none;
    transition: var(--transition-base);
  }

  textarea:focus {
    outline: none;
    border-color: var(--gold-primary);
    box-shadow: 0 0 10px rgba(255,215,0,0.3);
  }

  /* 4. å¼¹çª—æ·¡å…¥æ·¡å‡ºä¼˜åŒ–ï¼šæ›´ä¸æ»‘çš„è¿‡æ¸¡ */
  .modal, .prizeModal {
    position: fixed;
    inset: 0;
    background: var(--modal-overlay);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    /* æ ¸å¿ƒï¼šæ·¡å…¥æ·¡å‡º + æ¯›ç»ç’ƒè¿‡æ¸¡ */
    transition: opacity 0.5s ease, backdrop-filter 0.5s ease;
    opacity: 0;
    backdrop-filter: blur(0px);
    pointer-events: none;
  }

  .modal.active, .prizeModal.active {
    opacity: 1;
    backdrop-filter: blur(5px);
    pointer-events: auto;
  }

  .modal-box, .prizeModal-box {
    background: var(--modal-bg-gradient);
    padding: 30px 25px;
    border-radius: 20px;
    text-align: center;
    box-shadow: 0 0 30px var(--gold-primary), 0 0 60px var(--gold-shadow), 0 8px 24px rgba(0, 0, 0, 0.6);
    border: 2px solid var(--gold-secondary);
    max-width: 90%;
    width: 380px;
    /* å¼¹çª—ç¼©æ”¾ + ä½ç§»è¿‡æ¸¡ */
    transition: var(--transition-base);
    transform: scale(0.8) translateY(30px);
    position: relative;
    overflow: hidden;
    color: var(--text-white);
  }

  .modal.active .modal-box, .prizeModal.active .prizeModal-box {
    transform: scale(1.05) translateY(0);
  }

  .modal-box::before, .prizeModal-box::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at top right, rgba(255,215,0,0.1), transparent 70%);
    pointer-events: none;
  }

  .modal-box h2, .prizeModal-box h2 {
    color: var(--gold-primary);
    font-size: 24px;
    font-weight: 800;
    margin: 0 0 20px 0;
    text-shadow: 0 0 15px var(--gold-shadow), 0 2px 4px rgba(0,0,0,0.5);
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-tertiary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }

  #result {
    font-size: 30px;
    font-weight: 800;
    text-align: center;
    margin: 15px 0 25px;
    background: linear-gradient(135deg, #fff, var(--gold-primary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    -webkit-text-stroke: 2px var(--gold-dark);
    text-stroke: 2px var(--gold-dark);
    animation: breathe 2s infinite alternate ease-in-out;
    letter-spacing: 1px;
  }

  @keyframes breathe {
    0% {
      transform: scale(1);
      text-shadow: 0 0 10px var(--gold-shadow), 0 0 20px var(--gold-glow);
    }
    100% {
      transform: scale(1.15);
      text-shadow: 0 0 20px var(--gold-shadow), 0 0 40px var(--gold-glow), 0 0 60px var(--gold-primary);
    }
  }

  .modal-box button, .prizeModal-box button {
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary));
    color: var(--btn-text);
    border: none;
    border-radius: 50px;
    padding: 12px 30px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition-base);
    box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
    margin: 25px 25px;
  }

  button:hover:not(:disabled), button:active:not(:disabled) {
    color: #fff;
    background: linear-gradient(135deg, var(--gold-secondary), var(--gold-tertiary));
    box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
    transform: translateY(-3px);
  }

  button:active:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 2px 10px rgba(255, 215, 0, 0.4);
  }

  button:disabled {
    opacity: .4;
    cursor: not-allowed;
    transform: none !important;
    box-shadow: none !important;
  }

  /* åª’ä½“æŸ¥è¯¢ï¼šå°å±è®¾å¤‡è¿›ä¸€æ­¥ä¼˜åŒ– */
  @media screen and (max-width: 375px) {
    #result {
      font-size: 26px;
    }
    .modal-box, .prizeModal-box {
      padding: 25px 20px;
    }
    #startBtn {
      padding: 12px 30px;
      font-size: 16px;
    }
  }
</style>
</head>

<body>
<div class="container">
  <button id="themeToggle" class="control-btn" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
  <canvas id="canvas" width="600" height="600"></canvas>
  <button id="settingsBtn" class="control-btn" title="é…ç½®å¥–å“">âš™ï¸</button>
  <button id="startBtn">å¼€å§‹æŠ½å¥–</button>
</div>

<!-- ä¸­å¥–å¼¹æ¡† -->
<div class="modal" id="modal">
  <div class="modal-box">
    <h2>ğŸ‰ æ­å–œæŠ½ä¸­</h2>
    <p id="result"></p>
    <button onclick="closeModal()">ç¡®è®¤</button>
  </div>
</div>

<!-- å¥–å“è®¾ç½®å¼¹æ¡† -->
<div class="prizeModal" id="prizeInputModal">
  <div class="prizeModal-box">
    <h2>ğŸ é…ç½®å¥–å“ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</h2>
    <textarea id="prizeInput" placeholder="è¯·è¾“å…¥å¥–å“åç§°ï¼Œæ¯è¡Œä¸€ä¸ª"></textarea>
    <br>
    <button onclick="savePrizes()">ä¿å­˜</button>
    <button onclick="closePrizeModal()">å–æ¶ˆ</button>
  </div>
</div>

<script>
// ä¸»é¢˜åˆ‡æ¢é€»è¾‘
const root = document.documentElement;
const themeToggle = document.getElementById('themeToggle');
const savedTheme = localStorage.getItem('appTheme');

function detectSystemTheme() {
  return window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
}

function setTheme(theme) {
  root.setAttribute('data-theme', theme);
  localStorage.setItem('appTheme', theme);
  themeToggle.innerText = theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
}

if (savedTheme) {
  setTheme(savedTheme);
} else {
  setTheme(detectSystemTheme());
}

themeToggle.addEventListener('click', () => {
  const currentTheme = root.getAttribute('data-theme') || 'dark';
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
  setTheme(newTheme);
});

// å·¥å…·å‡½æ•°ï¼šè·å–CSSå˜é‡
function getCssVar(varName) {
  return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
}

// Canvasæ ¸å¿ƒé€»è¾‘ + ç§»åŠ¨é€‚é…
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('startBtn');
const settingsBtn = document.getElementById('settingsBtn');
const modal = document.getElementById('modal');
const result = document.getElementById('result');
const prizeModal = document.getElementById('prizeInputModal');
const prizeInput = document.getElementById('prizeInput');

// 5. ç§»åŠ¨è®¾å¤‡Canvasé«˜æ¸…é€‚é…ï¼šåŠ¨æ€è®¡ç®—å°ºå¯¸
function resizeCanvas() {
  const dpr = window.devicePixelRatio || 1;
  const canvasWidth = canvas.offsetWidth;
  const canvasHeight = canvas.offsetHeight;
  
  canvas.width = canvasWidth * dpr;
  canvas.height = canvasHeight * dpr;
  ctx.scale(dpr, dpr);
  
  // é‡ç½®è½¬ç›˜åŠå¾„
  radius = Math.min(canvasWidth, canvasHeight) / 2 - 10;
  drawWheel();
}

// ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼ˆé€‚é…æ—‹è½¬å±å¹•ï¼‰
window.addEventListener('resize', resizeCanvas);

// åˆå§‹åŒ–å‚æ•°
let radius = Math.min(canvas.offsetWidth, canvas.offsetHeight) / 2 - 10;
const cx = canvas.offsetWidth / 2;
const cy = canvas.offsetHeight / 2;

// å¥–å“åˆ—è¡¨
let prizes = [
  "ç›–ç é¥­", "å¼€å°èœ", "é‡‘æ‹±é—¨", "è¾¾ç¾ä¹", "èƒ¡å­å¤§å¨", "æ‘¸æ‘¸å®¶", "é™ˆé¦™è´µ", 
  "æ¥¼ä¸‹å…°å·æ‹‰é¢", "å¡”ä¸æ±€", "å…«å˜King", "æ¤’é”…é”…"
];
const savedPrizes = localStorage.getItem('prizes');
if (savedPrizes) {
  prizes = JSON.parse(savedPrizes);
}

const colors = prizes.map(() => randomColor());
let angle = 0;
let speed = 0;
let isSpinning = false;
let targetAngle = 0;
let slice = Math.PI * 2 / prizes.length;
const particles = [];

// 6. ç§»åŠ¨ç«¯ç²’å­æ•°é‡ä¼˜åŒ–ï¼šå‡å°‘å¡é¡¿
const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
const particleCount = isMobile ? 200 : 400;

class Particle {
  constructor() {
    this.x = cx;
    this.y = cy;
    const a = Math.random() * Math.PI * 2;
    const v = isMobile ? Math.random() * 6 + 3 : Math.random() * 10 + 5;
    this.vx = Math.cos(a) * v;
    this.vy = Math.sin(a) * v;
    this.life = isMobile ? 80 + Math.random() * 30 : 120 + Math.random() * 50;
    this.r = isMobile ? 1.5 + Math.random() * 2 : 2 + Math.random() * 3;
    this.color = `hsl(${40 + Math.random()*20},100%,${50 + Math.random()*20}%)`;
  }

  update() {
    this.x += this.vx;
    this.y += this.vy;
    this.vy += isMobile ? 0.02 : 0.03;
    this.vx *= 0.98;
    this.vy *= 0.98;
    this.life--;
  }

  draw() {
    ctx.globalAlpha = Math.max(this.life / (isMobile ? 100 : 150), 0);
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
    ctx.fill();
    ctx.globalAlpha = 1;
  }
}

function randomColor() {
  const h = 20 + Math.floor(Math.random() * 60);
  const s = 80 + Math.random() * 20;
  const l = 45 + Math.random() * 15;
  return `hsl(${h},${s}%,${l}%)`;
}

function lightenColor(color, percent) {
  const hsl = color.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);
  if (hsl) {
    const h = hsl[1];
    const s = hsl[2];
    let l = parseInt(hsl[3]) + percent;
    l = Math.min(100, Math.max(0, l));
    return `hsl(${h},${s}%,${l}%)`;
  }
  return color;
}

function drawWheel() {
  slice = Math.PI * 2 / prizes.length;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = "high";

  // è½¬ç›˜å¤–æ¡†
  ctx.save();
  ctx.translate(cx, cy);
  ctx.beginPath();
  ctx.arc(0, 0, radius + 5, 0, Math.PI * 2);
  ctx.fillStyle = "#111";
  ctx.fill();
  ctx.beginPath();
  ctx.arc(0, 0, radius + 3, 0, Math.PI * 2);
  ctx.fillStyle = getCssVar('--gold-dark');
  ctx.fill();
  ctx.restore();

  ctx.save();
  ctx.translate(cx, cy);
  ctx.rotate(angle);

  // 7. ç§»åŠ¨ç«¯æ–‡å­—å¤§å°é€‚é…
  const textSize = isMobile ? 12 : 16;
  prizes.forEach((text, i) => {
    ctx.beginPath();
    const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, radius);
    gradient.addColorStop(0, lightenColor(colors[i], 10));
    gradient.addColorStop(1, colors[i]);
    ctx.fillStyle = gradient;
    ctx.moveTo(0, 0);
    ctx.arc(0, 0, radius, i * slice, (i + 1) * slice);
    ctx.fill();

    ctx.strokeStyle = "#fff";
    ctx.lineWidth = 1.5;
    ctx.moveTo(0, 0);
    ctx.lineTo(radius * Math.cos(i * slice), radius * Math.sin(i * slice));
    ctx.stroke();

    ctx.save();
    ctx.rotate(i * slice + slice / 2);
    ctx.fillStyle = '#fff';
    ctx.font = `bold ${textSize}px "Microsoft Yahei", Arial`;
    ctx.textAlign = 'right';
    ctx.textBaseline = 'middle';
    ctx.shadowColor = 'rgba(0,0,0,0.5)';
    ctx.shadowBlur = 2;
    ctx.shadowOffsetX = 1;
    ctx.shadowOffsetY = 1;
    ctx.fillText(text, radius - 15, 0);
    ctx.shadowColor = 'transparent';
    ctx.restore();
  });

  ctx.restore();

  // æŒ‡é’ˆ
  ctx.save();
  const pointerScale = isSpinning ? 1 : (1 + Math.sin(Date.now() / 500) * 0.05);
  ctx.translate(cx, cy - radius + 10);
  ctx.scale(pointerScale, pointerScale);

  const pointerGradient = ctx.createLinearGradient(-12, -18, 12, 22);
  pointerGradient.addColorStop(0, '#fff');
  pointerGradient.addColorStop(1, getCssVar('--gold-primary'));
  ctx.fillStyle = pointerGradient;
  ctx.beginPath();
  ctx.moveTo(0, 22);
  ctx.lineTo(-12, -18);
  ctx.lineTo(12, -18);
  ctx.closePath();
  ctx.fill();

  ctx.strokeStyle = getCssVar('--gold-dark');
  ctx.lineWidth = 1;
  ctx.stroke();

  ctx.shadowColor = getCssVar('--gold-glow');
  ctx.shadowBlur = 10;
  ctx.fill();
  ctx.shadowColor = 'transparent';
  ctx.restore();
}

function animate() {
  drawWheel();

  particles.forEach(p => {
    p.update();
    p.draw();
  });

  for (let i = particles.length - 1; i >= 0; i--) {
    if (particles[i].life <= 0) particles.splice(i, 1);
  }

  if (isSpinning) {
    angle += speed;
    speed *= 0.985;
    if (speed < 0.002) {
      isSpinning = false;
      explode();
      setTimeout(showResult, 500);
    }
  } else {
    angle += 0.001;
  }

  requestAnimationFrame(animate);
}

function explode() {
  const count = isMobile ? particleCount : particleCount + 200;
  for (let i = 0; i < count; i++) particles.push(new Particle());
}

function showResult() {
  const index = getPrizeIndex();
  result.innerText = `${prizes[index]}`;
  modal.classList.add('active');
  startBtn.disabled = false;
}

function getPrizeIndex() {
  slice = Math.PI * 2 / prizes.length;
  let normalizedAngle = angle % (Math.PI * 2);
  if (normalizedAngle < 0) normalizedAngle += Math.PI * 2;
  let arrowAngle = (normalizedAngle + Math.PI / 2) % (Math.PI * 2);
  let index = Math.floor(arrowAngle / slice);
  index = (prizes.length - index - 1 + prizes.length) % prizes.length;
  return index;
}

startBtn.addEventListener('click', () => {
  if (isSpinning) return;
  startBtn.disabled = true;
  const finalIndex = Math.floor(Math.random() * prizes.length);
  targetAngle = Math.PI * 2 * 8 + (prizes.length - finalIndex) * slice - slice / 2;
  speed = isMobile ? 0.35 : 0.4;
  isSpinning = true;
});

// ç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶å…¼å®¹
startBtn.addEventListener('touchstart', (e) => {
  e.preventDefault();
  if (isSpinning) return;
  startBtn.disabled = true;
  const finalIndex = Math.floor(Math.random() * prizes.length);
  targetAngle = Math.PI * 2 * 8 + (prizes.length - finalIndex) * slice - slice / 2;
  speed = isMobile ? 0.35 : 0.4;
  isSpinning = true;
});

settingsBtn.addEventListener('click', () => {
  prizeInput.value = prizes.join('\n');
  prizeModal.classList.add('active');
});

function savePrizes() {
  const lines = prizeInput.value.split('\n').map(l => l.trim()).filter(l => l);
  if (lines.length > 0) {
    prizes = lines;
    colors.length = 0;
    colors.push(...prizes.map(() => randomColor()));
    localStorage.setItem('prizes', JSON.stringify(prizes));
  }
  prizeModal.classList.remove('active');
  drawWheel();
}

function closeModal() {
  modal.classList.remove('active');
  particles.length = 0;
}

function closePrizeModal() {
  prizeModal.classList.remove('active');
}

// åˆå§‹åŒ–
resizeCanvas();
animate();
</script>
</body>
</html>