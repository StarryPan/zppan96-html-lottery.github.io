<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Canvasç²’å­è½¬ç›˜æŠ½å¥–</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }

  :root {
    --modal-overlay: rgba(0, 0, 0, 0.85);
    --modal-bg: #1a1a1a;
    --modal-bg-gradient: linear-gradient(135deg, #1a1a1a, #222);
    --gold-primary: #ffd700;
    --gold-secondary: #ffc107;
    --gold-tertiary: #ffb300;
    --gold-dark: #e6b800;
    --gold-shadow: #ffecb3;
    --gold-glow: #fffacd;
    --text-white: #ffffff;
    --text-gray: #f5f5f5;
    --wheel-shadow: rgba(0,0,0,0.3);
    --body-bg: radial-gradient(circle at center, #2a2a2a, #000);
    --btn-text: #333;
    --textarea-bg: #222;
    --textarea-border: #ffc107;
    --transition-base: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    --shadow-soft: 0 0 8px rgba(255,215,0,0.15), 0 0 20px rgba(255,215,0,0.08);
  }

  :root[data-theme="light"] {
    --modal-overlay: rgba(255, 255, 255, 0.85);
    --modal-bg: #f8f9fa;
    --modal-bg-gradient: linear-gradient(135deg, #f8f9fa, #e9ecef);
    --gold-primary: #e6c200;
    --gold-secondary: #d4a800;
    --gold-tertiary: #c29400;
    --gold-dark: #b08000;
    --gold-shadow: #ffe880;
    --gold-glow: #fff2cc;
    --text-white: #212529;
    --text-gray: #495057;
    --wheel-shadow: rgba(0,0,0,0.1);
    --body-bg: radial-gradient(circle at center, #f5f5f5, #e9ecef);
    --btn-text: #212529;
    --textarea-bg: #ffffff;
    --textarea-border: #d4a800;
    --shadow-soft: 0 0 8px rgba(229,194,0,0.15), 0 0 20px rgba(229,194,0,0.08);
  }

  body {
    background: var(--body-bg);
    background-size: 150% 150%;
    animation: bgFloat 15s ease-in-out infinite alternate;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    color: var(--text-white);
    font-family: "Microsoft Yahei", Arial, sans-serif;
    overflow: hidden;
    padding: 15px;
    transition: var(--transition-base);
  }

  @keyframes bgFloat {
    0% { background-position: 0% 0%; }
    100% { background-position: 100% 100%; }
  }

  .container {
    text-align: center;
    position: relative;
    width: 100%;
    max-width: 600px;
    animation: containerBreathe 8s ease-in-out infinite alternate;
  }

  @keyframes containerBreathe {
    0% { transform: scale(1); }
    100% { transform: scale(1.02); }
  }

  .control-btn {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    background: rgba(255,215,0,0.1);
    border: 1px solid var(--gold-secondary);
    color: var(--gold-primary);
    transition: var(--transition-base);
    cursor: pointer;
    font-size: 24px;
    position: absolute;
    top: 0;
    z-index: 10;
    box-shadow: var(--shadow-soft);
  }

  #themeToggle {
    left: 0;
  }

  #settingsBtn {
    right: 0;
  }

  #canvas {
    display: block;
    margin: 0 auto;
    width: 90vw;
    height: 90vw;
    max-width: 600px;
    max-height: 600px;
    border-radius: 50%;
    box-shadow: 0 0 25px rgba(255,215,0,0.18), 0 0 50px var(--wheel-shadow), var(--shadow-soft);
    image-rendering: optimizeSpeed;
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    transform: translateZ(0);
    backface-visibility: hidden;
  }

  #startBtn {
    margin: 20px auto 0;
    padding: 15px 40px;
    font-size: 18px;
    font-weight: 700;
    border-radius: 50px;
    border: 2px solid var(--gold-primary);
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-tertiary));
    color: var(--btn-text);
    box-shadow: 0 4px 12px rgba(255,150,0,.6), 0 0 18px rgba(255,215,0,0.25), var(--shadow-soft);
    transition: var(--transition-base);
    position: relative;
    overflow: hidden;
    display: block;
    width: 80%;
    max-width: 300px;
    transform: translateZ(0);
  }

  #startBtn::after {
    content: "";
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(to right, transparent, rgba(255,255,255,0.18), transparent);
    transform: rotate(45deg);
    animation: btnShine 3s ease-in-out infinite;
  }

  @keyframes btnShine {
    0% { transform: rotate(45deg) translateX(-100%); }
    100% { transform: rotate(45deg) translateX(100%); }
  }

  /* ========== åœ†å½¢æ‚¬æµ®æŒ‰é’® + ç¾åŒ–æ»šåŠ¨æ¡ ========== */
  .prize-input-wrapper {
    width: 100%;
    max-width: 320px;
    margin: 0 auto;
    position: relative; /* ä¸ºæŒ‰é’®ç»å¯¹å®šä½åšå®¹å™¨ */
  }

  /* åœ†å½¢æ“ä½œæŒ‰é’® */
  .prize-ctrl-group {
    position: absolute;
    top: -20px; /* å‘ä¸Šåç§»ï¼Œè´´è¾¹æ¡† */
    right: 0px; /* é å³ */
    display: flex;
    gap: 8px; /* æŒ‰é’®é—´è· */
    z-index: 1; /* ç¡®ä¿åœ¨è¾“å…¥æ¡†ä¸Šæ–¹ */
  }

  .prize-ctrl-btn {
    width: 24px; /* åœ†å½¢ç›´å¾„ */
    height: 24px;
    border-radius: 50%; /* åœ†å½¢ */
    background: var(--textarea-bg); /* å’Œè¾“å…¥æ¡†èƒŒæ™¯ä¸€è‡´ */
    border: 1px solid var(--textarea-border); /* è¾¹æ¡†å’Œè¾“å…¥æ¡†ä¸€è‡´ */
    color: var(--gold-secondary); /* é‡‘è‰²å›¾æ ‡/æ–‡å­— */
    font-size: 12px; /* å°å­—ä½“/å›¾æ ‡ */
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 0; /* æ¸…é™¤å†…è¾¹è· */
    margin: 8px 2px !important;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* è½»å¾®é˜´å½±ï¼Œå¢åŠ å±‚æ¬¡æ„Ÿ */
  }

  .prize-ctrl-btn:hover {
    background: var(--gold-primary); /* æ‚¬æµ®é‡‘è‰²èƒŒæ™¯ */
    color: var(--btn-text); /* æ–‡å­—åè‰² */
    transform: scale(1.1); /* è½»å¾®æ”¾å¤§ */
    box-shadow: 0 0 8px rgba(255,215,0,0.3); /* é‡‘è‰²å…‰æ™• */
  }

  /* è¾“å…¥æ¡†æ ·å¼ */
  textarea#prizeInput {
    width: 100%;
    height: 180px;
    background: var(--textarea-bg);
    color: var(--text-white);
    border: 1px solid var(--textarea-border);
    border-radius: 8px;
    padding: 12px 12px 12px 12px; /* å³ä¾§é¢„ç•™æŒ‰é’®ç©ºé—´ */
    font-size: 14px;
    resize: none;
    outline: none;
    box-shadow: inset 0 0 4px rgba(0,0,0,0.05);
    /* æ»šåŠ¨æ¡ä¼˜åŒ–å‰ç½®ï¼šå…è®¸æ»šåŠ¨ */
    overflow-y: auto;
  }

  textarea#prizeInput:focus {
    border-color: var(--gold-primary);
    box-shadow: 0 0 8px rgba(255,215,0,0.25), inset 0 0 4px rgba(0,0,0,0.05);
  }

  /* ========== ç¾åŒ–æ»šåŠ¨æ¡æ ·å¼ (Webkitå†…æ ¸) ========== */
  /* æ»šåŠ¨æ¡æ•´ä½“ */
  textarea#prizeInput::-webkit-scrollbar {
    width: 6px; /* æ»šåŠ¨æ¡å®½åº¦ */
    height: 6px;
  }

  /* æ»šåŠ¨æ¡è½¨é“ */
  textarea#prizeInput::-webkit-scrollbar-track {
    background: var(--textarea-bg); /* å’Œè¾“å…¥æ¡†èƒŒæ™¯ä¸€è‡´ */
    border-radius: 3px; /* åœ†è§’ */
    margin: 8px 0; /* ä¸Šä¸‹ç•™ç©ºï¼Œä¸è´´è¾¹ */
  }

  /* æ»šåŠ¨æ¡æ»‘å— */
  textarea#prizeInput::-webkit-scrollbar-thumb {
    background: var(--gold-secondary); /* é‡‘è‰²æ»‘å— */
    border-radius: 3px; /* åœ†è§’ */
    transition: all 0.2s ease;
  }

  /* æ»‘å—æ‚¬æµ®æ•ˆæœ */
  textarea#prizeInput::-webkit-scrollbar-thumb:hover {
    background: var(--gold-primary); /* é«˜äº®é‡‘è‰² */
    box-shadow: 0 0 4px rgba(255,215,0,0.2);
  }

  /* æ»šåŠ¨æ¡è§’è½ */
  textarea#prizeInput::-webkit-scrollbar-corner {
    background: transparent; /* é€æ˜è§’è½ */
  }

  /* é€‚é…æµ…è‰²ä¸»é¢˜çš„æ»šåŠ¨æ¡ */
  :root[data-theme="light"] textarea#prizeInput::-webkit-scrollbar-thumb {
    background: var(--gold-secondary);
  }
  :root[data-theme="light"] textarea#prizeInput::-webkit-scrollbar-thumb:hover {
    background: var(--gold-primary);
  }
  /* ========== æ»šåŠ¨æ¡ç¾åŒ–ç»“æŸ ========== */

  .modal, .prizeModal {
    position: fixed;
    inset: 0;
    background: var(--modal-overlay);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    transition: opacity 0.5s ease, backdrop-filter 0.5s ease;
    opacity: 0;
    backdrop-filter: blur(0px);
    pointer-events: none;
  }

  .modal.active, .prizeModal.active {
    opacity: 1;
    backdrop-filter: blur(5px);
    pointer-events: auto;
  }

  .modal-box, .prizeModal-box {
    background: var(--modal-bg-gradient);
    padding: 30px 25px;
    border-radius: 20px;
    text-align: center;
    box-shadow: 0 0 25px var(--gold-primary), 0 0 50px var(--gold-shadow), 0 8px 20px rgba(0, 0, 0, 0.5), var(--shadow-soft);
    border: 2px solid var(--gold-secondary);
    max-width: 90%;
    width: 380px;
    transition: var(--transition-base);
    transform: scale(0.8) translateY(30px);
    position: relative;
    overflow: hidden;
    color: var(--text-white);
    transform: translateZ(0);
  }

  .modal.active .modal-box, .prizeModal.active .prizeModal-box {
    transform: scale(1.02) translateY(0);
  }

  .modal-box::before, .prizeModal-box::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at top right, rgba(255,215,0,0.08), transparent 70%);
    pointer-events: none;
  }

  .modal-box h2, .prizeModal-box h2 {
    color: var(--gold-primary);
    font-size: 24px;
    font-weight: 800;
    margin: 0 0 20px 0;
    text-shadow: 0 0 12px var(--gold-shadow), 0 2px 3px rgba(0,0,0,0.4);
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-tertiary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }

  #result {
    font-size: 30px;
    font-weight: 800;
    text-align: center;
    margin: 15px 0 25px;
    background: linear-gradient(135deg, #fff, var(--gold-primary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    -webkit-text-stroke: 2px var(--gold-dark);
    text-stroke: 2px var(--gold-dark);
    animation: breathe 2s infinite alternate ease-in-out;
    letter-spacing: 1px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  @keyframes breathe {
    0% {
      transform: scale(1);
      text-shadow: 0 0 8px var(--gold-shadow), 0 0 18px var(--gold-glow);
    }
    100% {
      transform: scale(1.12);
      text-shadow: 0 0 18px var(--gold-shadow), 0 0 35px var(--gold-glow), 0 0 55px var(--gold-primary);
    }
  }

  .modal-box button, .prizeModal-box button {
    background: linear-gradient(135deg, var(--gold-primary), var(--gold-secondary));
    color: var(--btn-text);
    border: none;
    border-radius: 50px;
    padding: 12px 24px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition-base);
    box-shadow: 0 4px 12px rgba(255, 215, 0, 0.35), var(--shadow-soft);
    margin: 8px 20px;
    -webkit-font-smoothing: antialiased;
    transform: translateZ(0);
  }

  button:hover:not(:disabled), button:active:not(:disabled) {
    color: #fff;
    background: linear-gradient(135deg, var(--gold-secondary), var(--gold-tertiary));
    box-shadow: 0 6px 18px rgba(255, 215, 0, 0.5), var(--shadow-soft);
    transform: translateY(-2px);
  }

  button:active:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(255, 215, 0, 0.35), var(--shadow-soft);
  }

  button:disabled {
    opacity: .4;
    cursor: not-allowed;
    transform: none !important;
    box-shadow: none !important;
  }

  @media screen and (max-width: 375px) {
    #result {
      font-size: 26px;
    }
    .modal-box, .prizeModal-box {
      padding: 25px 20px;
    }
    #startBtn {
      padding: 12px 30px;
      font-size: 16px;
    }
    /* ç§»åŠ¨ç«¯é€‚é…åœ†å½¢æŒ‰é’® */
    .prize-ctrl-btn {
      width: 22px;
      height: 22px;
      font-size: 11px;
    }
    .prize-ctrl-group {
      top: -10px;
      right: 10px;
    }
  }
</style>
</head>

<body>
<div class="container">
  <button id="themeToggle" class="control-btn" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
  <canvas id="canvas" width="600" height="600"></canvas>
  <button id="settingsBtn" class="control-btn" title="é…ç½®å¥–å“">âš™ï¸</button>
  <button id="startBtn">å¼€å§‹æŠ½å¥–</button>
</div>

<!-- ä¸­å¥–å¼¹æ¡† -->
<div class="modal" id="modal">
  <div class="modal-box">
    <h2>ğŸ‰ æ­å–œæŠ½ä¸­</h2>
    <p id="result"></p>
    <button onclick="closeModal()">ç¡®è®¤</button>
  </div>
</div>

<!-- å¥–å“è®¾ç½®å¼¹æ¡†ï¼ˆåœ†å½¢æ‚¬æµ®æŒ‰é’® + ç¾åŒ–æ»šåŠ¨æ¡ï¼‰ -->
<div class="prizeModal" id="prizeInputModal">
  <div class="prizeModal-box">
    <h2>ğŸ é…ç½®å¥–å“</h2>
    <div class="prize-input-wrapper">
      <!-- åœ†å½¢æ‚¬æµ®æŒ‰é’®ç»„ -->
      <div class="prize-ctrl-group">
        <button class="prize-ctrl-btn" onclick="clearPrizeInput()" title="æ¸…é™¤å†…å®¹">ğŸ—‘ï¸</button>
        <button class="prize-ctrl-btn" onclick="restoreDefaultPrizes()" title="è¿˜åŸé»˜è®¤">ğŸ”„</button>
      </div>
      <textarea id="prizeInput" placeholder="è¯·è¾“å…¥å¥–å“åç§°ï¼Œæ¢è¡Œåˆ†å‰²"></textarea>
    </div>
    <br>
    <button onclick="savePrizes()">ä¿å­˜</button>
    <button onclick="closePrizeModal()">å–æ¶ˆ</button>
  </div>
</div>

<script>
// ä¸»é¢˜åˆ‡æ¢é€»è¾‘
const root = document.documentElement;
const themeToggle = document.getElementById('themeToggle');
const savedTheme = localStorage.getItem('appTheme');

// å­˜å‚¨é»˜è®¤å¥–å“åˆ—è¡¨ï¼ˆç”¨äºè¿˜åŸï¼‰
const DEFAULT_PRIZES = [
  "ç›–ç é¥­", "å¼€å°èœ", "é‡‘æ‹±é—¨", "è¾¾ç¾ä¹", "èƒ¡å­å¤§å¨", "æ‘¸æ‘¸å®¶", "é™ˆé¦™è´µ", 
  "æ¥¼ä¸‹å…°å·æ‹‰é¢", "å¡”ä¸æ±€", "å…«å˜King", "æ¤’é”…é”…"
];

function detectSystemTheme() {
  return window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark';
}

function setTheme(theme) {
  root.setAttribute('data-theme', theme);
  localStorage.setItem('appTheme', theme);
  themeToggle.innerText = theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
}

if (savedTheme) {
  setTheme(savedTheme);
} else {
  setTheme(detectSystemTheme());
}

themeToggle.addEventListener('click', () => {
  const currentTheme = root.getAttribute('data-theme') || 'dark';
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
  setTheme(newTheme);
});

// å·¥å…·å‡½æ•°ï¼šè·å–CSSå˜é‡
function getCssVar(varName) {
  return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
}

// Canvasæ ¸å¿ƒé€»è¾‘ + ä¼˜åŒ–æ¸²æŸ“
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('startBtn');
const settingsBtn = document.getElementById('settingsBtn');
const modal = document.getElementById('modal');
const result = document.getElementById('result');
const prizeModal = document.getElementById('prizeInputModal');
const prizeInput = document.getElementById('prizeInput');

// ä¼˜åŒ–ï¼šCanvasé«˜æ¸…æ¸²æŸ“ + æŠ—é”¯é½¿
function resizeCanvas() {
  const dpr = window.devicePixelRatio || 1;
  const canvasWidth = canvas.offsetWidth;
  const canvasHeight = canvas.offsetHeight;
  
  // ä¼˜åŒ–ï¼šæ•´æ•°åŒ–å°ºå¯¸ï¼Œé¿å…å°æ•°åƒç´ å¯¼è‡´çš„é”¯é½¿
  canvas.width = Math.floor(canvasWidth * dpr);
  canvas.height = Math.floor(canvasHeight * dpr);
  // å¼ºåˆ¶å¼€å¯æŠ—é”¯é½¿
  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = "high"; // é«˜ç”»è´¨æŠ—é”¯é½¿
  ctx.scale(dpr, dpr);
  
  // é‡ç½®è½¬ç›˜åŠå¾„ï¼ˆæ•´æ•°åŒ–ï¼‰
  radius = Math.floor(Math.min(canvasWidth, canvasHeight) / 2 - 10);
  drawWheel();
}

// ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼ˆé€‚é…æ—‹è½¬å±å¹•ï¼‰
window.addEventListener('resize', resizeCanvas);

// åˆå§‹åŒ–å‚æ•°
let radius = Math.floor(Math.min(canvas.offsetWidth, canvas.offsetHeight) / 2 - 10);
const cx = canvas.offsetWidth / 2;
const cy = canvas.offsetHeight / 2;

// å¥–å“åˆ—è¡¨
let prizes = [...DEFAULT_PRIZES]; // æ·±æ‹·è´é»˜è®¤åˆ—è¡¨
const savedPrizes = localStorage.getItem('prizes');
if (savedPrizes) {
  try {
    const parsed = JSON.parse(savedPrizes);
    if (Array.isArray(parsed) && parsed.length > 0) {
      prizes = parsed;
    }
  } catch (e) {
    prizes = [...DEFAULT_PRIZES]; // è§£æå¤±è´¥åˆ™ç”¨é»˜è®¤å€¼
  }
}

const colors = prizes.map(() => randomColor());
let angle = 0;
let speed = 0;
let isSpinning = false;
let targetAngle = 0;
let slice = Math.PI * 2 / prizes.length;
const particles = [];

// ç§»åŠ¨ç«¯ç²’å­æ•°é‡ä¼˜åŒ–ï¼šå‡å°‘å¡é¡¿
const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
const particleCount = isMobile ? 180 : 350; // ä¼˜åŒ–ï¼šå‡å°‘ç²’å­æ•°é‡ï¼Œæå‡æµç•…åº¦

class Particle {
  constructor() {
    this.x = cx;
    this.y = cy;
    const a = Math.random() * Math.PI * 2;
    const v = isMobile ? Math.random() * 5 + 2 : Math.random() * 8 + 4; // ä¼˜åŒ–ï¼šç²’å­é€Ÿåº¦æ›´æŸ”å’Œ
    this.vx = Math.cos(a) * v;
    this.vy = Math.sin(a) * v;
    this.life = isMobile ? 70 + Math.random() * 20 : 100 + Math.random() * 30; // ä¼˜åŒ–ï¼šç”Ÿå‘½å‘¨æœŸæ›´åˆç†
    this.r = isMobile ? 1.2 + Math.random() * 1.5 : 1.8 + Math.random() * 2.5; // ä¼˜åŒ–ï¼šç²’å­å°ºå¯¸æ›´å°ï¼Œé¿å…é©¬èµ›å…‹
    this.color = `hsl(${40 + Math.random()*20},100%,${50 + Math.random()*20}%)`;
  }

  update() {
    this.x += this.vx;
    this.y += this.vy;
    this.vy += isMobile ? 0.018 : 0.025; // ä¼˜åŒ–ï¼šé‡åŠ›æ›´æŸ”å’Œ
    this.vx *= 0.982; // ä¼˜åŒ–ï¼šå‡é€Ÿæ›´å¹³æ»‘
    this.vy *= 0.982;
    this.life--;
  }

  draw() {
    // ä¼˜åŒ–ï¼šç²’å­é€æ˜åº¦è¿‡æ¸¡æ›´å¹³æ»‘
    const alpha = Math.max(this.life / (isMobile ? 90 : 130), 0);
    ctx.globalAlpha = alpha;
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
    ctx.fill();
    ctx.globalAlpha = 1;
  }
}

function randomColor() {
  const h = 20 + Math.floor(Math.random() * 60);
  const s = 80 + Math.random() * 20;
  const l = 45 + Math.random() * 15;
  return `hsl(${h},${s}%,${l}%)`;
}

function lightenColor(color, percent) {
  const hsl = color.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);
  if (hsl) {
    const h = hsl[1];
    const s = hsl[2];
    let l = parseInt(hsl[3]) + percent;
    l = Math.min(100, Math.max(0, l));
    return `hsl(${h},${s}%,${l}%)`;
  }
  return color;
}

function drawWheel() {
  slice = Math.PI * 2 / prizes.length;
  // ä¼˜åŒ–ï¼šæ¸…é™¤ç”»å¸ƒæ—¶ä½¿ç”¨æ•´æ•°åæ ‡ï¼Œé¿å…æ¨¡ç³Š
  ctx.clearRect(0, 0, Math.floor(canvas.width), Math.floor(canvas.height));
  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = "high";

  // è½¬ç›˜å¤–æ¡†ï¼ˆä¼˜åŒ–ï¼šçº¿æ¡æ›´ç»†è…»ï¼‰
  ctx.save();
  ctx.translate(cx, cy);
  ctx.beginPath();
  ctx.arc(0, 0, radius + 5, 0, Math.PI * 2);
  ctx.fillStyle = "#111";
  ctx.fill();
  ctx.beginPath();
  ctx.arc(0, 0, radius + 3, 0, Math.PI * 2);
  ctx.fillStyle = getCssVar('--gold-dark');
  ctx.fill();
  ctx.restore();

  ctx.save();
  ctx.translate(cx, cy);
  ctx.rotate(angle);

  // ä¼˜åŒ–ï¼šæ–‡å­—å¤§å°é€‚é…æ›´ç²¾å‡†
  const textSize = isMobile ? Math.max(10, Math.floor(12 * (radius / 280))) : Math.max(14, Math.floor(16 * (radius / 280)));
  
  prizes.forEach((text, i) => {
    ctx.beginPath();
    const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, radius);
    gradient.addColorStop(0, lightenColor(colors[i], 10));
    gradient.addColorStop(1, colors[i]);
    ctx.fillStyle = gradient;
    ctx.moveTo(0, 0);
    ctx.arc(0, 0, radius, i * slice, (i + 1) * slice);
    ctx.fill();

    // ä¼˜åŒ–ï¼šåˆ†å‰²çº¿æ›´ç»†ï¼ŒæŠ—é”¯é½¿
    ctx.strokeStyle = "#fff";
    ctx.lineWidth = 1.2; // ä¼˜åŒ–ï¼šçº¿æ¡å®½åº¦æ›´ç»†è…»
    ctx.moveTo(0, 0);
    ctx.lineTo(radius * Math.cos(i * slice), radius * Math.sin(i * slice));
    ctx.stroke();

    ctx.save();
    ctx.rotate(i * slice + slice / 2);
    ctx.fillStyle = '#fff';
    ctx.font = `bold ${textSize}px "Microsoft Yahei", Arial`;
    ctx.textAlign = 'right';
    ctx.textBaseline = 'middle';
    // ä¼˜åŒ–ï¼šæ–‡å­—é˜´å½±æ›´æŸ”å’Œ
    ctx.shadowColor = 'rgba(0,0,0,0.4)';
    ctx.shadowBlur = 1.5;
    ctx.shadowOffsetX = 0.8;
    ctx.shadowOffsetY = 0.8;
    // ä¼˜åŒ–ï¼šæ–‡å­—ä½ç½®æ›´åˆç†ï¼Œé¿å…æº¢å‡º
    ctx.fillText(text, radius - 12, 0);
    ctx.shadowColor = 'transparent';
    ctx.restore();
  });

  ctx.restore();

  // æŒ‡é’ˆï¼ˆä¼˜åŒ–ï¼šæ¸²æŸ“æ›´ç»†è…»ï¼‰
  ctx.save();
  const pointerScale = isSpinning ? 1 : (1 + Math.sin(Date.now() / 500) * 0.04); // ä¼˜åŒ–ï¼šå‘¼å¸å¹…åº¦æ›´å°ï¼Œæ›´è‡ªç„¶
  ctx.translate(cx, cy - radius + 10);
  ctx.scale(pointerScale, pointerScale);

  const pointerGradient = ctx.createLinearGradient(-12, -18, 12, 22);
  pointerGradient.addColorStop(0, '#fff');
  pointerGradient.addColorStop(1, getCssVar('--gold-primary'));
  ctx.fillStyle = pointerGradient;
  ctx.beginPath();
  ctx.moveTo(0, 22);
  ctx.lineTo(-12, -18);
  ctx.lineTo(12, -18);
  ctx.closePath();
  ctx.fill();

  ctx.strokeStyle = getCssVar('--gold-dark');
  ctx.lineWidth = 1;
  ctx.stroke();

  // ä¼˜åŒ–ï¼šæŒ‡é’ˆæ³›å…‰æ›´æŸ”å’Œ
  ctx.shadowColor = getCssVar('--gold-glow');
  ctx.shadowBlur = 8; // ä¼˜åŒ–ï¼šé˜´å½±æ¨¡ç³Šåº¦é™ä½ï¼Œé¿å…é©¬èµ›å…‹
  ctx.fill();
  ctx.shadowColor = 'transparent';
  ctx.restore();
}

function animate() {
  drawWheel();

  particles.forEach(p => {
    p.update();
    p.draw();
  });

  for (let i = particles.length - 1; i >= 0; i--) {
    if (particles[i].life <= 0) particles.splice(i, 1);
  }

  if (isSpinning) {
    angle += speed;
    speed *= 0.988; // ä¼˜åŒ–ï¼šå‡é€Ÿæ›²çº¿æ›´å¹³æ»‘
    if (speed < 0.0015) { // ä¼˜åŒ–ï¼šåœæ­¢é˜ˆå€¼æ›´ç²¾å‡†
      isSpinning = false;
      explode();
      setTimeout(showResult, 500);
    }
  } else {
    angle += 0.0008; // ä¼˜åŒ–ï¼šé—²ç½®æ—‹è½¬é€Ÿåº¦æ›´æ…¢ï¼Œæ›´è‡ªç„¶
  }

  requestAnimationFrame(animate);
}

function explode() {
  const count = isMobile ? particleCount : particleCount + 150; // ä¼˜åŒ–ï¼šå‡å°‘ç²’å­æ•°é‡ï¼Œæå‡æµç•…åº¦
  for (let i = 0; i < count; i++) particles.push(new Particle());
}

function showResult() {
  const index = getPrizeIndex();
  result.innerText = `${prizes[index]}`;
  modal.classList.add('active');
  startBtn.disabled = false;
}

function getPrizeIndex() {
  slice = Math.PI * 2 / prizes.length;
  let normalizedAngle = angle % (Math.PI * 2);
  if (normalizedAngle < 0) normalizedAngle += Math.PI * 2;
  let arrowAngle = (normalizedAngle + Math.PI / 2) % (Math.PI * 2);
  let index = Math.floor(arrowAngle / slice);
  index = (prizes.length - index - 1 + prizes.length) % prizes.length;
  return index;
}

startBtn.addEventListener('click', () => {
  if (isSpinning) return;
  startBtn.disabled = true;
  const finalIndex = Math.floor(Math.random() * prizes.length);
  targetAngle = Math.PI * 2 * 8 + (prizes.length - finalIndex) * slice - slice / 2;
  speed = isMobile ? 0.32 : 0.38; // ä¼˜åŒ–ï¼šæ—‹è½¬é€Ÿåº¦æ›´æŸ”å’Œ
  isSpinning = true;
});

// ç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶å…¼å®¹
startBtn.addEventListener('touchstart', (e) => {
  e.preventDefault();
  if (isSpinning) return;
  startBtn.disabled = true;
  const finalIndex = Math.floor(Math.random() * prizes.length);
  targetAngle = Math.PI * 2 * 8 + (prizes.length - finalIndex) * slice - slice / 2;
  speed = isMobile ? 0.32 : 0.38;
  isSpinning = true;
});

settingsBtn.addEventListener('click', () => {
  prizeInput.value = prizes.join('\n');
  prizeModal.classList.add('active');
});

// æ¸…é™¤textareaå†…å®¹
function clearPrizeInput() {
  prizeInput.value = '';
  prizeInput.focus();
}

// è¿˜åŸé»˜è®¤å¥–å“å†…å®¹
function restoreDefaultPrizes() {
  prizeInput.value = DEFAULT_PRIZES.join('\n');
  prizeInput.focus();
}

function savePrizes() {
  const lines = prizeInput.value.split('\n').map(l => l.trim()).filter(l => l);
  if (lines.length > 0) {
    prizes = lines;
    colors.length = 0;
    colors.push(...prizes.map(() => randomColor()));
    localStorage.setItem('prizes', JSON.stringify(prizes));
  }
  prizeModal.classList.remove('active');
  drawWheel();
}

function closeModal() {
  modal.classList.remove('active');
  particles.length = 0;
}

function closePrizeModal() {
  prizeModal.classList.remove('active');
}

// åˆå§‹åŒ–
resizeCanvas();
animate();
</script>
</body>
</html>